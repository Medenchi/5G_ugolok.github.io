<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }

    body {
      background: #1a1a1a;
      color: white;
    }

    header.header {
      background: linear-gradient(to right, #c21010, #e63946);
      text-align: center;
      padding: 2rem;
      font-family: 'Playfair Display', serif;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    .tab {
      cursor: pointer;
      padding: 1rem 2rem;
      background: #333;
      border-radius: 10px;
      transition: background 0.3s;
    }

    .tab.active {
      background: #ff3b3b;
      color: black;
    }

    .admin-panel {
      max-width: 800px;
      margin: auto;
      background: #222;
      border-radius: 15px;
      padding: 2rem;
    }

    input, textarea, select, button {
      width: 100%;
      padding: 0.75rem;
      margin: 0.5rem 0;
      border: none;
      border-radius: 10px;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    button {
      background: #ff3b3b;
      color: white;
      cursor: pointer;
    }

    .list {
      margin-top: 2rem;
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #333;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .list-item button {
      background: #c21010;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
    }

    .logout-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #4caf50;
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }

    .back-btn a {
      display: block;
      text-align: center;
      margin-top: 2rem;
      background: #222;
      color: #ff3b3b !important;
      padding: 0.8rem 2rem;
      border-radius: 20px;
      text-decoration: none;
      border: 2px solid #ff3b3b;
    }

    .back-btn a:hover {
      background: #ff3b3b;
      color: #222 !important;
    }
  </style>
</head>
<body>

<header class="header">
  <h1>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
</header>

<div class="tabs">
  <div class="tab active" onclick="switchTab('heroes')">–ì–µ—Ä–æ–∏</div>
  <div class="tab" onclick="switchTab('history')">–ò—Å—Ç–æ—Ä–∏—è</div>
  <div class="tab" onclick="switchTab('weapons')">–û—Ä—É–∂–∏–µ</div>
  <div class="tab" onclick="switchTab('equipment')">–í–æ–æ—Ä—É–∂–µ–Ω–∏–µ</div>
  <div class="tab" onclick="switchTab('admins')">üîß –ê–¥–º–∏–Ω—ã</div>
</div>

<div class="admin-panel" id="adminPanel">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ -->
  <h2 style="color:white;" id="panelTitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</h2>

  <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div id="loginForm">
    <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω">
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="checkLogin()">–í–æ–π—Ç–∏</button>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
  <div id="controlPanel" style="display:none;">
    <!-- –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö -->
    <select id="currentAdminSelect">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç</option>
    </select>

    <input id="titleInput" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ / –ò–º—è –≥–µ—Ä–æ—è / –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è">
    <textarea id="contentInput" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
    <input id="imageInput" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)">
    <button onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å</button>

    <!-- –°–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ -->
    <div class="list" id="itemsList"></div>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏ -->
  <div id="adminsPanel" style="display:none;">
    <input id="newAdminLogin" placeholder="–ù–æ–≤—ã–π –ª–æ–≥–∏–Ω">
    <input id="newAdminPass" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
    <button onclick="addAdmin()">–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞</button>

    <div class="list" id="adminsList"></div>
  </div>
</div>

<button class="logout-btn" onclick="logout()">‚¨Ö –í—ã–π—Ç–∏</button>

<a href="index.html" class="back-btn" style="margin: 2rem; display:block;">‚¨Ö –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a>

<script>
  // --- –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π ---
  async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  // --- –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ ---
  let admins = JSON.parse(localStorage.getItem("admins")) || [
    { login: "DenchikTop1", password: "DenchikTop1" }
  ];

  // --- –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–æ–≤ ---
  let heroes = JSON.parse(localStorage.getItem("soviet_heroes")) || [];
  let historyData = JSON.parse(localStorage.getItem("history")) || [];
  let weapons = JSON.parse(localStorage.getItem("weapons")) || [];
  let equipments = JSON.parse(localStorage.getItem("equipments")) || [];

  let currentSection = null;

  function saveData() {
    localStorage.setItem("soviet_heroes", JSON.stringify(heroes));
    localStorage.setItem("history", JSON.stringify(historyData));
    localStorage.setItem("weapons", JSON.stringify(weapons));
    localStorage.setItem("equipments", JSON.stringify(equipments));
    localStorage.setItem("admins", JSON.stringify(admins));
  }

  function checkLogin() {
    const user = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();

    hashPassword(pass).then(hashedPass => {
      const admin = admins.find(a => a.login === user && a.password === hashedPass);

      if (admin) {
        localStorage.setItem("adminLogged", "true");
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("controlPanel").style.display = "block";
        switchTab("heroes"); // –û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª
        renderItems();
      } else {
        alert("‚ö†Ô∏è –õ–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã!");
      }

      // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞—Ä—ã–π –∞–¥–º–∏–Ω ‚Äî –ø–µ—Ä–µ—Ö—ç—à–∏—Ä—É–µ–º –µ–≥–æ
      const realAdmin = admins.find(a => a.login === user && a.password === pass);
      if (realAdmin) {
        realAdmin.password = hashedPass;
        saveData();
      }
    });
  }

  function switchTab(tab) {
    currentSection = tab;
    document.querySelectorAll(".tab").forEach(el => el.classList.remove("active"));
    document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add("active");

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø–∞–Ω–µ–ª–∏
    document.getElementById("controlPanel").style.display = ["heroes", "history", "weapons", "equipment"].includes(tab) ? "block" : "none";
    document.getElementById("adminsPanel").style.display = tab === "admins" ? "block" : "none";

    // –†–µ–Ω–¥–µ—Ä–∏–º –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (["heroes", "history", "weapons", "equipment"].includes(tab)) {
      renderItems();
    } else if (tab === "admins") {
      renderAdminList();
    }
  }

  function renderItems() {
    const container = document.getElementById("itemsList");
    const titleEl = document.getElementById("panelTitle");
    const imageInput = document.getElementById("imageInput");

    let items = [];
    let titleText = "";

    switch(currentSection) {
      case "heroes":
        items = heroes;
        titleText = "–ì–µ—Ä–æ–∏ –°–æ–≤–µ—Ç—Å–∫–æ–≥–æ –°–æ—é–∑–∞";
        imageInput.style.display = "block";
        break;
      case "history":
        items = historyData;
        titleText = "–ò—Å—Ç–æ—Ä–∏—è –≤–æ–π–Ω—ã";
        imageInput.style.display = "none";
        break;
      case "weapons":
        items = weapons;
        titleText = "–û—Ä—É–∂–∏–µ";
        imageInput.style.display = "block";
        break;
      case "equipment":
        items = equipments;
        titleText = "–í–æ–æ—Ä—É–∂–µ–Ω–∏–µ";
        imageInput.style.display = "block";
        break;
    }

    titleEl.textContent = titleText;
    container.innerHTML = "";

    items.forEach((item, index) => {
      const title = item.title;
      const content = item.content || item.description;
      const image = item.image ? `<br><small>–§–æ—Ç–æ: ${item.image}</small>` : '';
      container.innerHTML += `
        <div class="list-item">
          <div style="flex:1;">
            <strong>${title}</strong><br>
            <small>${content ? content.substring(0, 60) + (content.length > 60 ? '...' : '') : ''}</small>${image}
          </div>
          <div>
            <button onclick="editItem(${index})">‚úèÔ∏è</button>
            <button onclick="deleteItem(${index})">üóë</button>
          </div>
        </div>
      `;
    });

    updateAdminSelect();
  }

  function addItem() {
    const title = document.getElementById("titleInput").value.trim();
    const content = document.getElementById("contentInput").value.trim();
    const image = document.getElementById("imageInput").value.trim();

    if (!title || !content) return;

    let newItem;
    switch(currentSection) {
      case "heroes":
        newItem = { title, content, image };
        heroes.push(newItem);
        break;
      case "history":
        newItem = { title, content };
        historyData.push(newItem);
        break;
      case "weapons":
        newItem = { title, description: content, image };
        weapons.push(newItem);
        break;
      case "equipment":
        newItem = { title, description: content, image };
        equipments.push(newItem);
        break;
    }

    saveData();
    renderItems();
    clearForm();
  }

  function editItem(index) {
    let item;
    switch(currentSection) {
      case "heroes": item = heroes[index]; break;
      case "history": item = historyData[index]; break;
      case "weapons": item = weapons[index]; break;
      case "equipment": item = equipments[index]; break;
    }

    document.getElementById("titleInput").value = item.title;
    document.getElementById("contentInput").value = item.content || item.description;
    if (item.image) document.getElementById("imageInput").value = item.image;

    window.editIndex = index;
    window.isEditing = true;
  }

  function deleteItem(index) {
    if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?")) return;

    switch(currentSection) {
      case "heroes": heroes.splice(index, 1); break;
      case "history": historyData.splice(index, 1); break;
      case "weapons": weapons.splice(index, 1); break;
      case "equipment": equipments.splice(index, 1); break;
    }

    saveData();
    renderItems();
  }

  function clearForm() {
    document.getElementById("titleInput").value = "";
    document.getElementById("contentInput").value = "";
    document.getElementById("imageInput").value = "";
    window.editIndex = null;
    window.isEditing = false;
  }

  function logout() {
    localStorage.removeItem("adminLogged");
    location.reload();
  }

  // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏ ---
  function addAdmin() {
    const login = document.getElementById("newAdminLogin").value.trim();
    const pass = document.getElementById("newAdminPass").value.trim();

    if (!login || !pass) return alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");

    const exists = admins.some(a => a.login === login);
    if (exists) return alert("‚ö†Ô∏è –ê–¥–º–∏–Ω —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");

    hashPassword(pass).then(hashedPass => {
      admins.push({ login, password: hashedPass });
      saveData();
      document.getElementById("newAdminLogin").value = "";
      document.getElementById("newAdminPass").value = "";
      renderAdminList();
    });
  }

  function removeAdmin(login) {
    if (login === "DenchikTop1") {
      alert("‚ö†Ô∏è –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞");
      return;
    }

    if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∞–¥–º–∏–Ω–∞?")) return;

    admins = admins.filter(a => a.login !== login);
    saveData();
    renderAdminList();
  }

  function renderAdminList() {
    const container = document.getElementById("adminsList");
    container.innerHTML = "";

    admins.forEach((a, i) => {
      container.innerHTML += `
        <div class="list-item">
          <div style="flex:1;"><strong>${a.login}</strong></div>
          <div>
            ${a.login === "DenchikTop1" ? '<small>–†–µ–∑–µ—Ä–≤–Ω—ã–π</small>' : `<button onclick="removeAdmin('${a.login}')">üóë –£–¥–∞–ª–∏—Ç—å</button>`}
          </div>
        </div>
      `;
    });
  }

  function updateAdminSelect() {
    const select = document.getElementById("currentAdminSelect");
    select.innerHTML = "";
    admins.forEach(a => {
      select.innerHTML += `<option value="${a.login}">${a.login}</option>`;
    });
  }

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
  document.addEventListener("DOMContentLoaded", () => {
    const storedAdmins = JSON.parse(localStorage.getItem("admins")) || [
      { login: "DenchikTop1", password: "DenchikTop1" }
    ];

    if (storedAdmins.some(a => a.password.length !== 64)) {
      alert("‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –∫–∞–∂–¥—ã–º, —á—Ç–æ–±—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏—Ö.");
    }

    admins = storedAdmins;
    saveData();

    if (localStorage.getItem("adminLogged") === "true") {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("controlPanel").style.display = "block";
      switchTab("heroes");
    }

    updateAdminSelect();
  });
</script>

</body>
</html>
